import sqlite3

conn = sqlite3.connect(r"C:\Users\katya\Documents\GitHub\PyWebDZ6\database")
cursor = conn.cursor()

#знайти 5 студентів із найбільшим середнім балом з усіх предметів
cursor.execute('''
    SELECT students.name, AVG(grades.grade) as avg_grade
    FROM students
    JOIN grades ON students.id = grades.student_id
    GROUP BY students.id
    ORDER BY avg_grade DESC
    LIMIT 5
''')
result = cursor.fetchall()
print("Запит 1:")
for row in result:
    print(row)

#знайти студента із найвищим середнім балом з певного предмета
subject_id = 1
cursor.execute('''
    SELECT students.name, AVG(grades.grade) as avg_grade
    FROM students
    JOIN grades ON students.id = grades.student_id
    WHERE grades.subject_id = ?
    GROUP BY students.id
    ORDER BY avg_grade DESC
    LIMIT 1
''', (subject_id,))
result = cursor.fetchall()
print("Запит 2:")
for row in result:
    print(row)

#знайти середній бал у групах з певного предмета
subject_id = 1 
cursor.execute('''
    SELECT groups.name, AVG(grades.grade) as avg_grade
    FROM groups
    JOIN students ON groups.id = students.group_id
    JOIN grades ON students.id = grades.student_id
    WHERE grades.subject_id = ?
    GROUP BY groups.id
''', (subject_id,))
result = cursor.fetchall()
print("Запит 3:")
for row in result:
    print(row)

#знайти середній бал на потоці
cursor.execute('''
    SELECT AVG(grade) as avg_grade
    FROM grades
''')
result = cursor.fetchall()
print("Запит 4:")
for row in result:
    print(row)

#знайти які курси читає певний викладач
teacher_id = 1 
cursor.execute('''
    SELECT subjects.name
    FROM subjects
    WHERE subjects.teacher_id = ?
''', (teacher_id,))
result = cursor.fetchall()
print("Запит 5:")
for row in result:
    print(row)

#знайти список студентів у певній групі 
group_id = 1
cursor.execute('''
    SELECT students.name
    FROM students
    WHERE students.group_id = ?
''', (group_id,))
result = cursor.fetchall()
print("Запит 6:")
for row in result:
    print(row)

#знайти оцінки студентів у окремій групі з певного предмета
group_id = 1  
subject_id = 1 
cursor.execute('''
    SELECT students.name, grades.grade
    FROM students
    JOIN grades ON students.id = grades.student_id
    WHERE students.group_id = ? AND grades.subject_id = ?
''', (group_id, subject_id))
result = cursor.fetchall()
print("Запит 7:")
for row in result:
    print(row)

#знайти середній бал, який ставить певний викладач зі своїх предметів (замість <teacher_id> підставте ідентифікатор викладача)
teacher_id = 1 
cursor.execute('''
    SELECT AVG(grades.grade) as avg_grade
    FROM subjects
    JOIN grades ON subjects.id = grades.subject_id
    WHERE subjects.teacher_id = ?
''', (teacher_id,))
result = cursor.fetchall()
print("Запит 8:")
for row in result:
    print(row)

#знайти список курсів, які відвідує студент 
student_id = 1
cursor.execute('''
    SELECT subjects.name
    FROM subjects
    JOIN grades ON subjects.id = grades.subject_id
    WHERE grades.student_id = ?
''', (student_id,))
result = cursor.fetchall()
print("Запит 9:")
for row in result:
    print(row)

#список курсів, які певному студенту читає певний викладач 
student_id = 1  
teacher_id = 1 
cursor.execute('''
    SELECT subjects.name
    FROM subjects
    JOIN grades ON subjects.id = grades.subject_id
    JOIN students ON grades.student_id = students.id
    WHERE students.id = ? AND subjects.teacher_id = ?
''', (student_id, teacher_id))
result = cursor.fetchall()
print("Запит 10:")
for row in result:
    print(row)

#збереження змін та закриття з'єднання
conn.commit()
conn.close()